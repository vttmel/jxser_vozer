
-- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com - 
-- script viet hoa By http://tranhba.com  nghiªm träng thanh minh # nµy v¨n kiÖn kh«ng hót tù phï chuçi 
-- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com - 

-- script viet hoa By http://tranhba.com  lÔ quan ch©n vèn 
-- script viet hoa By http://tranhba.com  Li_Xin 2004-8-17 
-- script viet hoa By http://tranhba.com Include( "\\script\\global\\ÖÐÇï»î¶¯.lua" )

-- script viet hoa By http://tranhba.com TASKID_HOLIDAY_GIFT_DATE = 160; -- script viet hoa By http://tranhba.com  nhiÖm vô thay ®æi l­îng ID of nhµ ch¬i mét lÇn cuèi cïng nhËn lÊy ngµy lÔ lÔ vËt thêi gian 
-- script viet hoa By http://tranhba.com TASKTMPID_HOLIDAY_GIFT_DATE = 160; -- script viet hoa By http://tranhba.com  t¹m thêi nhiÖm vô thay ®æi l­îng ID of nhµ ch¬i mét lÇn cuèi cïng nhËn lÊy ngµy lÔ lÔ vËt thêi gian 
Include( "\\script\\event\\eventhead.lua" )
Include("\\script\\event\\maincity\\event.lua")	-- script viet hoa By http://tranhba.com  Ö÷³Ç½±Àø
Include("\\script\\event\\superplayeract2007\\event.lua")-- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com ³¬¼¶Íæ¼Ò»î¶¯
Include("\\script\\event\\great_night\\event.lua")	-- script viet hoa By http://tranhba.com  »Ô»ÍÖ®Ò¹
Include("\\script\\misc\\ex_goldequp_coin.lua");	-- script viet hoa By http://tranhba.com  ¶Ò»»»Æ½ð×°±¸½ðÅÆ
Include("\\script\\event\\jiefang_jieri\\201004\\main.lua");
Include("\\script\\event\\jiefang_jieri\\201004\\refining_iron\\Npc.lua") -- script viet hoa By http://tranhba.com  Á¶½ð»î¶¯


-- script viet hoa By http://tranhba.com  ViÖt Nam 0904 gi¶i phãng ho¹t ®éng 
-- script viet hoa By http://tranhba.com Include("\\script\\event\\jiefang_jieri\\200904\\zhanshenzhujiu\\jiu_hecheng.lua");
-- script viet hoa By http://tranhba.com Include("\\script\\event\\jiefang_jieri\\200904\\jinnangshijian\\jinnangshijian.lua");
-- script viet hoa By http://tranhba.com Include("\\script\\event\\jiefang_jieri\\200904\\denggao\\denggao.lua");
-- script viet hoa By http://tranhba.com Include("\\script\\event\\jiefang_jieri\\200904\\shuizei\\shuizei.lua");
-- script viet hoa By http://tranhba.com Include("\\script\\event\\jiefang_jieri\\200904\\taskctrl.lua");

Include("\\script\\event\\guoqing_jieri\\200908\\compose.lua")
Include("\\script\\event\\other\\jilixinwanjia\\200908\\npcdailog.lua")

-- script viet hoa By http://tranhba.com  ViÖt Nam 0905 sinh nhËt ho¹t ®éng 
-- script viet hoa By http://tranhba.com Include("\\script\\event\\birthday_jieri\\200905\\npc\\npc_liguan_dailog.lua");
Include("\\script\\misc\\vngpromotion\\ipbonus\\ipbonus_2_npc.lua");

Include("\\script\\activitysys\\g_activity.lua")
Include("\\script\\dailogsys\\g_dialog.lua")
Include("\\script\\activitysys\\playerfunlib.lua")

Include("\\script\\activitysys\\npcfunlib.lua")

Include("\\script\\task\\killmonster\\killmonster.lua")
Include("\\script\\misc\\eventsys\\type\\npc.lua")

-- script viet hoa By http://tranhba.com tinhpn 20100817: Online Award 
Include("\\script\\bonus_onlinetime\\head.lua")
Include("\\script\\bonus_onlinetime\\func_onlineaward.lua")
Include("\\script\\vonghoa\\exchangitem\\exchangeitem.lua")
Include("\\script\\vonghoa\\item\\head.lua")
Include("\\script\\traogiaithdnb\\thdnb7.lua");-- script viet hoa By http://tranhba.com 20100908 haint code function trao giai thdnb
Include("\\script\\baoruongthanbi\\dialogmain.lua")
Include("\\script\\vlkh\\vlkh1.lua")

-- script viet hoa By http://tranhba.com tinhpn 20101022: Event Thang 10 
Include("\\script\\vng_event\\201010\\head.lua")
Include("\\script\\vng_event\\compensate.lua")
Include("\\script\\vng_event\\traogiai\\vldnb2010\\vlbnb.lua")

-- script viet hoa By http://tranhba.com [DinhHQ] 
-- script viet hoa By http://tranhba.com [20110107]:trao giai Phuong Anh Hao thang 12 2010 
	Include("\\script\\vng_event\\traogiai\\pah_12_2010\\head.lua")
-- script viet hoa By http://tranhba.com [20110124]:Vip account 2011 
	Include("\\script\\vng_event\\vip_account_2011\\npc\\lequan.lua")
-- script viet hoa By http://tranhba.com [20110216]:THDNB8 
	Include("\\script\\vng_event\\20110215_THDNB8\\vng_thdnb8_award.lua")
-- script viet hoa By http://tranhba.com [20110225]: 8/3/2011 
	Include("\\script\\vng_event\\20110225_8_thang_3\\npc\\lequan.lua")
-- script viet hoa By http://tranhba.com [20110311]: NPAH thang 02 2011 
	Include("\\script\\vng_event\\20110215_THDNB8\\vng_npah0211.lua")

	Include("\\script\\vng_event\\traogiai\\NPAH\\vng_ToolAward.lua")
-- script viet hoa By http://tranhba.com tinhpn 20110223:Reset pass ruong 
Include("\\script\\vng_feature\\resetbox.lua")
Include("\\script\\vng_event\\traogiai\\vlmc2011\\vlmc2011_main.lua")

function main() 


local nCurDate = tonumber(GetLocalDate("%Y%m%d%H%M")) 
local nNpcIndex = GetLastDiagNpc(); 
local szNpcName = GetNpcName(nNpcIndex) 
if NpcName2Replace then 
szNpcName = NpcName2Replace(szNpcName) 
end 

local tbDailog = DailogClass:new(szNpcName) 
EventSys:GetType("AddNpcOption"):OnEvent(szNpcName, tbDailog, nNpcIndex) 
-- script viet hoa By http://tranhba.com [DinhHQ] 
-- script viet hoa By http://tranhba.com [20110107]: dÉn t­ëng ph­¬ng anh hµo t­ëng th­ëng 
-- script viet hoa By http://tranhba.com  tbPAH122010_Head:addDialog(tbDailog) 
-- script viet hoa By http://tranhba.com [20110124]:Vip account 2011 
tbVNG_VipAcc2011_LeQuan:addDialog(tbDailog) 
-- script viet hoa By http://tranhba.com [20110216]:THDNB8 
tbVNG_THDNB8:AddDialog(tbDailog) 
-- script viet hoa By http://tranhba.com [20110225]: 8/3/2011 
tbVNGWD2011_LeQuan:AddDialog(tbDailog) 
-- script viet hoa By http://tranhba.com [20110311]: NPAH thang 02 2011 
tbVNG_NPAH0211:AddDialog(tbDailog) 
-- script viet hoa By http://tranhba.com  ®ãng hµo quang VLMC2011 - Modified by DinhHQ - 20110523 
tbVLMC2011_Tittle:AddDialog(tbDailog) 
tbVngToolAward:AddDialog(tbDailog) 
G_ACTIVITY:OnMessage("ClickNpc", tbDailog, nNpcIndex) 
-- script viet hoa By http://tranhba.com  b¾n ra ®èi tho¹i khu«ng 
tbDailog:AddOptEntry("Huy hoµng chi ®ªm ", onGreat_Night) 
-- script viet hoa By http://tranhba.com  tbDailog:AddOptEntry("Tham gia thÇn bÝ b¶o r­¬ng ho¹t ®éng ", BRTB_Dialog_main) 
-- script viet hoa By http://tranhba.com  tbDailog:AddOptEntry("DÉn vâ l©m ®Ö nhÊt bang chung kÕt t­ëng ", GetBonusVLDNB2010_main) 
-- script viet hoa By http://tranhba.com  tbDailog:AddOptEntry("NhËn lÊy ®ång tiÒn ", Compensate_main) 
-- script viet hoa By http://tranhba.com  if (VH_ActiveDay()==1) then 
-- script viet hoa By http://tranhba.com  tbDailog:AddOptEntry("Ta ®Ó ®æi 8 th¸ng ®Ých event vËt phÈm ", ExChangeItem_main) 
-- script viet hoa By http://tranhba.com  end 
tbDailog:AddOptEntry("Khai Pass r­¬ng ", ResetBox.ShowDialog, {ResetBox}) 

-- script viet hoa By http://tranhba.com tinhpn 20101022: Event Thang 10 
-- script viet hoa By http://tranhba.com  if (Event201010:IsActive() == 1) then 
-- script viet hoa By http://tranhba.com  tbDailog:AddOptEntry("§æi 10 th¸ng ®Ých ho¹t ®éng phÇn th­ëng ", Event201010.ShowDialog, {Event201010}) 
-- script viet hoa By http://tranhba.com  end 

if IsIPBonus() then 
tbDailog:AddOptEntry("C¬ khÝ sö dông CSM trî gióp ", IpBonus) 
end 

-- script viet hoa By http://tranhba.com tinhpn 20100817: Online Award 
-- script viet hoa By http://tranhba.com  if (OnlineAward_StartDate() ~= 0 and OnlineAward_Check_TransferLife() ~= 0) then 
-- script viet hoa By http://tranhba.com  tbDailog:AddOptEntry("Tham gia online dÉn t­ëng ", OnlineAward); 
-- script viet hoa By http://tranhba.com  end 

local ncity = gb_GetTask("MAINCITYCFG", 1); 
local nCurMapID = SubWorldIdx2ID(SubWorld); 
if (ncity >= 1 and ncity <= 7 and nCurMapID == TB_MAINCITY_CITYWAR_T[ncity][2]) then 
tbDailog:AddOptEntry("NhËn lÊy Th¸i thó phÇn th­ëng ", maincity_award_entry) 
end 
if tbJILIWanJia0908:IsActDate() then 
tbDailog:AddOptEntry("KÝch tay míi ho¹t ®éng ", tbJILIWanJia0908.DailogMain, {tbJILIWanJia0908} ) 
end 


if FreedomEvent2010:IsActive1() == 1 then 
tbDailog:AddOptEntry("ChiÕn sÜ dïng/uèng ®¹o cô ", FreedomEvent2010.LiGuanEventItemDlg, {FreedomEvent2010}) 
end 

if tbRefiningIron:CheckCondition() == 1 then 
tbDailog:AddOptEntry("RÌn luyÖn thiÕt ho¹t ®éng ", tbRefiningIron.NpcTalk, {tbRefiningIron}) 
end 

tbDailog:Show() 
end 

function jiefang0904_act() 
Say(" lÔ quan : b©y giê lµ ¨n mõng gi¶i phãng ngµy ho¹t ®éng trong lóc , ®¹i nh©n ®øa trÎ còng h­ng cao th¶i liÖt ®Þa ¨n mõng th¾ng lîi , ®¹i hiÖp muèn tham gia sao ?", 6, 
" ta tíi nhËn lÊy cÈm nang sù kiÖn /jf0904_getjinnangshijian", 
format("Th¾ng lîi r­îu ho¹t ®éng /#tbJiefang0904_jiu:OnDailogMain()"), 
" lªn ®Ønh FanXiPan ho¹t ®éng /about_denggao", 
" oanh liÖt thiªn thu ho¹t ®éng /about_shuizei", 
" tiªu diÖt n­íc tÆc nhiÖm vô /about_shuizei", 
" ta ch¼ng qua lµ xem mét chót !/OnCancel"); 
end 

Include([[\script\event\menglan_2006\menglan_2006.lua]]); 
function v_menglanjie() 
Say("Ta ®¹i biÓu ThiÕu L©m ph­¬ng tr­îng c¶m t¹ còng chóc phóc ng­¬i !", 7, 
" ta ®em kim liªn xµi hÕt hoµn d©ng tÆng cho ng­¬i /#v_mljaward(1)", 
" ta ®em méc hoa sen hµo quang d©ng tÆng cho ng­¬i /#v_mljaward(2)", 
" ta ®em n­íc hoa sen hµo quang d©ng tÆng cho ng­¬i /#v_mljaward(3)", 
" ta c©y ®uèc hoa sen hµo quang d©ng tÆng cho ng­¬i /#v_mljaward(4)", 
" ta ®em ®Êt hoa sen hµo quang d©ng tÆng cho ng­¬i /#v_mljaward(5)", 
" ta ®em hoa sen hµo quang d©ng tÆng cho ng­¬i , mçi hÖ mét ./v_mljaward_all", 
" ta ch¼ng qua lµ tß mß ®i ngang qua xem mét chót mµ th«i !/OnCancel" 
); 
end; 

function v_mljaward(nIdx) 
	if (CalcEquiproomItemCount(6,1,tab_NPCIdx[nIdx][1] + 5,-1) < 1) then
Say("Ng­¬i kh«ng muèn d©ng tÆng "..tab_NPCIdx[nIdx][2].." sao ? ng­¬i thËt gièng nh­ kh«ng cã mang "..tab_NPCIdx[nIdx][2].."!", 1,"Ta ®i tr­íc chuÈn bÞ !/OnCancel") 
return 
end; 

local nCount = GetTask(tab_NPCIdx[nIdx][3]); 
if (nCount >= SIMGER_LIMIT) then 
Say("Ng­¬i ®· d©ng tÆng ®ñ "..tab_NPCIdx[nIdx][2].." liÔu # d©ng tÆng ®iÓm kh¸c ®Ých ®i !", 0); 
return 
end; 

	ConsumeEquiproomItem(1, 6, 1, tab_NPCIdx[nIdx][1] + 5, -1);
	SetTask(tab_NPCIdx[nIdx][3], nCount + 1);
AddOwnExp(500000); 
Say("Qu¸ tr©n quý # ®©y lµ ThiÕu L©m ph­¬ng tr­îng cïng Nga Mi ch­ëng m«n ®­a cho ng­¬i mét chót t©m ý .", 1,"TiÕp nhËn lÔ vËt ./OnCancel"); 
Msg2Player("Ng­¬i lÊy ®­îc <color=yellow>500000<color> chót kinh nghiÖm ."); 
end; 

function v_mljaward_all() 
for i = 1, getn(tab_NPCIdx) do 
		if (CalcEquiproomItemCount(6,1,tab_NPCIdx[i][1] + 5,-1) < 1) then
Say("Ng­¬i kh«ng muèn d©ng tÆng "..tab_NPCIdx[i][2].." sao ? ng­¬i thËt gièng nh­ kh«ng cã mang "..tab_NPCIdx[i][2].."!", 1,"Ta ®i tr­íc chuÈn bÞ !/OnCancel") 
return 
end; 
end; 

local nCount = GetTask(TK_LOTUS_ALL); 
if (nCount >= TOGETHER_LIMIT) then 
Say("ThËt lµ c¸m ¬n ng­¬i # nh­ng lµ 12 c¸ bao tiÒn l× x× ®· ®­a hoµn cho ng­êi ta liÔu .", 0); 
return 
end; 

for i = 1, getn(tab_NPCIdx) do 
		ConsumeEquiproomItem(1, 6, 1, tab_NPCIdx[i][1] + 5, -1);
end; 
	SetTask(TK_LOTUS_ALL, nCount + 1);

AddOwnExp(1000000); 
AddItem(6, 1, 1136, 1, 0, 0, 0); -- script viet hoa By http://tranhba.com  thªm mét giã lín tói # 
Say("Qu¸ tr©n quý # ®©y lµ ThiÕu L©m ph­¬ng tr­îng cïng Nga Mi ch­ëng m«n ®­a cho ng­¬i mét chót t©m ý .", 1,"TiÕp nhËn lÔ vËt ./OnCancel"); 
Msg2Player("Ng­¬i lÊy ®­îc <color=yellow>1000000<color> chót kinh nghiÖm cïng 1 c¸ <color=yellow> bao tiÒn l× x× <color>"); 
end; 

-- script viet hoa By http://tranhba.com  ngµy lÔ liÖt biÓu 
aryHoliday = { -- script viet hoa By http://tranhba.com  ngµy lÔ thêi gian , phï hîp ngµy lÔ thêi gian së ®iÒu hµm sè tªn , t¸i diÔn dÉn lÔ phÈm ®Ých ®Ò kú v¨n vèn 
{ 20040822, onHoliday_QiXi,"KhÝ trêi tèt nh­ vËy # c¸c ng­¬i 2 vÞ t¹i sao kh«ng ®i du v­ên ®©y , vÉn cßn ë c¸i nµy lµm g× ?" } 
-- script viet hoa By http://tranhba.com  kú tha ngµy lÔ 
}; 

function valentineGift() 
if (GetBit(GetTask(67),24) == 1) then 
if (GetBit(GetTask(1313),1) ~= 1) then 
SetTask(1313, SetBit(GetTask(1313), 1, 1)) 
Talk(1, "", "<#> h«m nay lµ nh÷ng thø nµy hØ kÕt l­¬ng duyÕn ng­êi cña ®Ých ngµy thËt tèt # ta cã lÔ vËt muèn tÆng cho kÕt h«n ng­êi cña # chóc c¸c vÞ b¹c ®Çu giai l·o #") 
-- script viet hoa By http://tranhba.com  ®­a 2 c¸ “ t©m t©m t­¬ng Ên phï ” 
for i = 1, 2 do 
AddItem( 6, 1, 18, 1, 0, 0 ,0); 
end 
Msg2Player( "<#> ng­¬i lÊy ®­îc hai t©m t©m t­¬ng Ên phï " ); 
-- script viet hoa By http://tranhba.com  ®­a 9 ®ãa “ hoa hång ” 
for i = 1, 9 do 
AddItem( 6, 0, 20, 1, 0, 0 ,0); 
end 
Msg2Player( "<#> ng­¬i lÊy ®­îc 9 ®ãa hoa hång !" ); 
-- script viet hoa By http://tranhba.com  50 cÊp trë lªn nhµ ch¬i thªm ®­a 1 c¸ “ Thiªn S¬n ngäc lé ” 
if( GetLevel() >= 50 ) then 
AddItem(6, 1, 72, 1, 0, 0, 0); 
Msg2Player( "<#> ng­¬i lÊy ®­îc mét chai Thiªn S¬n b¶o lé " ); 
end 
else 
Talk(1, "", "<#> ng­¬i kh«ng ph¶i lµ ®· nhËn lÊy qua sao ? ®Ó cho ng­êi kh¸c ®Õn ®©y ®i #") 
end 
else 
Talk(1, "", "<#> ng­¬i cßn ch­a cã kÕt h«n , kh«ng thÓ dÉn lÔ vËt ") 
end 
end 
-- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com  hñy bá -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com -- script viet hoa By http://tranhba.com  
function OnCancel() 
end 

function LiguanLog(object) 
WriteLog(date("%H%M%S") .. ": tr­¬ng môc :" .. GetAccount() .. ", nh©n vËt :" .. GetName() .. "," .. object); 
end 
